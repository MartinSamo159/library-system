<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>U≈æivatel√© - Library System</title>
    <style>
        body {
          font-family: Arial, sans-serif;
          background: #f4f6f9;
          margin: 0;
          padding: 20px;
        }
        header {
          background: #007bff;
          color: white;
          padding: 10px;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }
        header nav a, header nav button {
          color: white;
          margin-left: 15px;
          text-decoration: none;
          font-weight: bold;
          background: none;
          border: none;
          cursor: pointer;
          font-size: 1em;
        }
        header nav button:hover, header nav a:hover {
          text-decoration: underline;
        }
        .section {
          margin: 20px 0;
          padding: 15px;
          background: white;
          border-radius: 5px;
          box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 10px;
        }
        th, td {
          border: 1px solid #ddd;
          padding: 8px;
          text-align: left;
        }
        th {
          background: #f2f2f2;
        }
        button {
          padding: 6px 12px;
          margin: 3px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
        }
        .btn-danger { background: #dc3545; color: white; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
    </style>
</head>
<body>
<header>
    <h2>üìö Library System</h2>
    <nav>
        <a href="books.html">Knihy</a>
        <a href="loans.html">V√Ωp≈Øjƒçky</a>
        <a href="users.html" id="users-link">U≈æivatel√©</a>
        <button onclick="logout()">Odhl√°sit se</button>
    </nav>
</header>

<h2>U≈æivatel√©</h2>

<!-- Formul√°≈ô pro p≈ôid√°n√≠ -->
<div class="section">
    <h3>P≈ôidat nov√©ho u≈æivatele</h3>
    <label>Jm√©no:</label>
    <input type="text" id="userName" placeholder="Nap≈ô. Jan Nov√°k">
    <label>Email:</label>
    <input type="email" id="userEmail" placeholder="nap≈ô. jan@example.com">
    <label>Role:</label>
    <select id="userRole">
        <option value="READER">reader</option>
        <option value="LIBRARIAN">librarian</option>
        <option value="ADMIN">admin</option>
    </select>
    <button class="btn-success" onclick="createUser()">P≈ôidat</button>
</div>

<!-- Tabulka u≈æivatel≈Ø -->
<div class="section">
    <h3>Seznam u≈æivatel≈Ø</h3>
    <table id="users-table">
        <thead>
        <tr>
            <th>ID</th><th>Jm√©no</th><th>Email</th><th>Role</th><th>Akce</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
    // --- P≈ôihl√°≈°en√≠ a role ---
    const username = localStorage.getItem("username");
    const password = localStorage.getItem("password");
    if (!username || !password) {
      window.location.href = "login.html";
    }
    const authHeader = "Basic " + btoa(username + ":" + password);

    // logout
    function logout() {
      localStorage.removeItem("username");
      localStorage.removeItem("password");
      window.location.href = "login.html";
    }

    // --- Naƒç√≠st u≈æivatele ---
    function loadUsers() {
      fetch("/users", { headers: { "Authorization": authHeader } })
        .then(res => res.json())
        .then(users => {
          const tbody = document.querySelector("#users-table tbody");
          tbody.innerHTML = "";
          users.forEach(u => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${u.id}</td>
              <td>${u.name}</td>
              <td>${u.email}</td>
              <td>${u.role}</td>
              <td>
                <button class="btn-danger" onclick="deleteUser(${u.id})">Smazat</button>
              </td>
            `;
            tbody.appendChild(tr);
          });
        });
    }

    // --- P≈ôidat u≈æivatele ---
    function createUser() {
      const name = document.getElementById("userName").value;
      const email = document.getElementById("userEmail").value;
      const role = document.getElementById("userRole").value;

      fetch("/users", {
        method: "POST",
        headers: {
            "Authorization": authHeader,
            "Content-Type": "application/json"
            },
        body: JSON.stringify({ name, email, role })
      })
      .then(async res => {
        if (res.ok) {
          alert("‚úÖ U≈æivatel p≈ôid√°n");
          loadUsers();
        } else if (res.status === 400) {
          const errors = await res.json();
          let msg = "‚ùå Chyby ve formul√°≈ôi:\n";
          for (const field in errors) {
            msg += `- ${field}: ${errors[field]}\n`;
          }
          alert(msg);
        } else {
            const text = await res.text();
            alert(`‚ùå Chyba p≈ôi p≈ôid√°n√≠ u≈æivatele (${res.status}): ${text}`);
        }
      });
    }

    // --- Smazat u≈æivatele ---
    function deleteUser(id) {
      if (!confirm("Opravdu chcete smazat u≈æivatele?")) return;

      fetch("/users/" + id, {
        method: "DELETE",
        headers: { "Authorization": authHeader }
      }).then(async res => {
        if (res.ok) {
            alert("‚úÖ U≈æivatel smaz√°n");
            loadUsers();
      } else {
        let msg;
        try {
            const data = await res.json();
            msg = data.error || JSON.stringify(data);
        } catch {
            msg = await res.text();
        }
        alert(`‚ùå Chyba p≈ôi maz√°n√≠ (${res.status}): ${msg}`);
    }
  });
}

    // Inicializace
    function initPage() {
      loadUsers();
    }

    initPage();
</script>
</body>
</html>
